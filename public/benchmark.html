<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div>
      <canvas style="max-width: 100vw; max-height: 95vh" id="myChart"></canvas>
    </div>

    <script src="/scripts/benchmark/chart.js@2.9.3.js"></script>
    <script src="/scripts/benchmark/hammerjs@2.0.8.js"></script>
    <script src="/scripts/benchmark/chartjs-plugin-zoom@0.7.7.js"></script>
    <script src="./durations.js" defer></script>
    <script>
      const ctx = document.getElementById('myChart');
      const drawChart = (chartData) => {
        const myChart = new Chart(ctx, {
          type: 'line',
          data: chartData,
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'top',
              },
              zoom: {
                // Container for pan options
                pan: {
                  // Boolean to enable panning
                  enabled: true,

                  // Panning directions. Remove the appropriate direction to disable
                  // Eg. 'y' would only allow panning in the y direction
                  // A function that is called as the user is panning and returns the
                  // available directions can also be used:
                  //   mode: function({ chart }) {
                  //     return 'xy';
                  //   },
                  mode: 'xy',

                  rangeMin: {
                    // Format of min pan range depends on scale type
                    x: null,
                    y: null,
                  },
                  rangeMax: {
                    // Format of max pan range depends on scale type
                    x: null,
                    y: null,
                  },

                  // On category scale, factor of pan velocity
                  speed: 20,

                  // Minimal pan distance required before actually applying pan
                  threshold: 10,

                  // Function called while the user is panning
                  // onPan: function ({ chart }) {
                  //   console.log(`I'm panning!!!`);
                  // },
                  // // Function called once panning is completed
                  // onPanComplete: function ({ chart }) {
                  //   console.log(`I was panned!!!`);
                  // },
                },

                // Container for zoom options
                zoom: {
                  // Boolean to enable zooming
                  enabled: true,

                  // Enable drag-to-zoom behavior
                  drag: false,

                  // Drag-to-zoom effect can be customized
                  // drag: {
                  // 	 borderColor: 'rgba(225,225,225,0.3)'
                  // 	 borderWidth: 5,
                  // 	 backgroundColor: 'rgb(225,225,225)',
                  // 	 animationDuration: 0
                  // },

                  // Zooming directions. Remove the appropriate direction to disable
                  // Eg. 'y' would only allow zooming in the y direction
                  // A function that is called as the user is zooming and returns the
                  // available directions can also be used:
                  //   mode: function({ chart }) {
                  //     return 'xy';
                  //   },
                  mode: 'xy',

                  rangeMin: {
                    // Format of min zoom range depends on scale type
                    x: null,
                    y: null,
                  },
                  rangeMax: {
                    // Format of max zoom range depends on scale type
                    x: null,
                    y: null,
                  },

                  // Speed of zoom via mouse wheel
                  // (percentage of zoom on a wheel event)
                  speed: 0.1,

                  // Minimal zoom distance required before actually applying zoom
                  threshold: 2,

                  // On category scale, minimal zoom level before actually applying zoom
                  sensitivity: 3,

                  // Function called while the user is zooming
                  // onZoom: function ({ chart }) {
                  //   console.log(`I'm zooming!!!`);
                  // },
                  // // Function called once zooming is completed
                  // onZoomComplete: function ({ chart }) {
                  //   console.log(`I was zoomed!!!`);
                  // },
                },
              },
              // title: {
              //   display: true,
              //   text: "Chart.js Line Chart",
              // },
            },
          },
        });
      };
      // get durations from the server in port 5000 using post request
      const getChartData = async (durs) => {
        let durations = durs;
        if (!durs) {
          const res = await fetch('http://localhost:5000/durations', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
          });
          durations = await res.json();
        }
        return {
          labels: Object.keys(durations.js),
          datasets: [
            {
              label: 'JS',
              data: Object.values(durations.js),
              borderColor: 'rgba(66, 245, 81, 1)',
              borderWidth: 2,
              fill: false,
            },
            {
              label: 'WASM',
              data: Object.values(durations.wasm),
              borderColor: 'rgba(50, 149, 219, 1)',
              borderWidth: 2,
              fill: false,
            },
            {
              label: 'WebGPU',
              data: Object.values(durations.webgpu),
              borderColor: 'rgba(212, 63, 30, 1)',
              borderWidth: 3.5,
              fill: false,
            },
          ],
        };
      };
      // test if server is up and running
      fetch('http://localhost:5000/durations')
        .then((res) => {
          getChartData().then((chartData) => {
            drawChart(chartData);
          });
        })
        .catch((err) => {
          // draw chart using window.durations
          getChartData(window.durations).then((chartData) => {
            drawChart(chartData);
          });
        });
    </script>
    <script type="module">
      import { io } from '/scripts/benchmark/socket.io.esm.min.js';

      const socket = io('ws://localhost:5000');
      socket.on('durations', (durations) => {
        console.log('duration io: ', durations);
        getChartData(durations).then((chartData) => {
          drawChart(chartData);
        });
      });
    </script>
  </body>
</html>
